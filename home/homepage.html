<!DOCTYPE html>
<html>
<head>
    <title>Shell Employee Dashboard</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background-color: white; display: flex; flex-direction: column; min-height: 100vh; }
        .w3-bar { background-color: #d50000 !important; color: white; }
        .w3-button { color: white !important; }
        .content { flex: 1; padding: 60px 20px 20px; }
        .card { background-color: #e0e0e0; padding: 20px; border-radius: 10px; margin-top: 20px; }
        footer { margin-top: auto; }
    </style>
    <script>
        const supabase = window.supabase.createClient(
            'https://nyfcjxeebjzejsutbgub.supabase.co',
            'YOUR_SUPABASE_ANON_KEY'
        );

        async function checkAuth() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) {
                window.location.href = "login.html";
            }
        }
        
        async function addEmployee(event) {
            event.preventDefault();
            const name = document.getElementById('name').value;
            const department = document.getElementById('department').value;
            const role = document.getElementById('role').value;
            const branch = document.getElementById('branch').value;
            const start_time = document.getElementById('start_time').value;
            const end_time = document.getElementById('end_time').value;
            
            const { error } = await supabase
                .from('employees')
                .insert([{ name, department, role, branch, start_time, end_time }]);

            if (error) {
                alert('Error adding employee: ' + error.message);
            } else {
                alert('Employee added successfully!');
                document.getElementById('addEmployeeForm').reset();
                document.getElementById('addEmployeeModal').style.display = 'none';
                loadEmployees();
            }
        }

        async function loadEmployees() {
            const { data, error } = await supabase.from('employees').select('*');
            if (error) {
                console.error("Error fetching employees:", error);
                return;
            }
            const tableBody = document.getElementById('employeeTableBody');
            tableBody.innerHTML = '';

            data.forEach(emp => {
                let newRow = tableBody.insertRow();
                newRow.innerHTML = `<td>${emp.id}</td>
                                    <td>${emp.name}</td>
                                    <td>${emp.department}</td>
                                    <td>${emp.role}</td>
                                    <td>${emp.branch}</td>
                                    <td>${emp.start_time}</td>
                                    <td>${emp.end_time}</td>
                                    <td>
                                        <button class="w3-button w3-small w3-blue" onclick="editEmployee(${emp.id}, '${emp.name}', '${emp.department}', '${emp.role}', '${emp.branch}', '${emp.start_time}', '${emp.end_time}')">Edit</button>
                                        <button class="w3-button w3-small w3-red" onclick="deleteEmployee(${emp.id})">Delete</button>
                                    </td>`;
            });
        }

        async function deleteEmployee(id) {
            if (confirm("Are you sure you want to delete this employee?")) {
                const { error } = await supabase.from('employees').delete().eq('id', id);
                if (error) {
                    alert('Error deleting employee: ' + error.message);
                } else {
                    alert('Employee deleted successfully!');
                    loadEmployees();
                }
            }
        }

        function editEmployee(id, name, department, role, branch, start_time, end_time) {
            document.getElementById('edit_id').value = id;
            document.getElementById('edit_name').value = name;
            document.getElementById('edit_department').value = department;
            document.getElementById('edit_role').value = role;
            document.getElementById('edit_branch').value = branch;
            document.getElementById('edit_start_time').value = start_time;
            document.getElementById('edit_end_time').value = end_time;
            document.getElementById('editEmployeeModal').style.display = 'block';
        }

        async function updateEmployee(event) {
            event.preventDefault();
            const id = document.getElementById('edit_id').value;
            const name = document.getElementById('edit_name').value;
            const department = document.getElementById('edit_department').value;
            const role = document.getElementById('edit_role').value;
            const branch = document.getElementById('edit_branch').value;
            const start_time = document.getElementById('edit_start_time').value;
            const end_time = document.getElementById('edit_end_time').value;
            
            const { error } = await supabase.from('employees').update({ name, department, role, branch, start_time, end_time }).eq('id', id);
            if (error) {
                alert('Error updating employee: ' + error.message);
            } else {
                alert('Employee updated successfully!');
                document.getElementById('editEmployeeModal').style.display = 'none';
                loadEmployees();
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            checkAuth();
            loadEmployees();
        });
    </script>
</head>
<body>
    <div class="w3-container">
        <h2>Employee Management</h2>
        <table class="w3-table w3-bordered">
            <tr><th>ID</th><th>Name</th><th>Department</th><th>Role</th><th>Branch</th><th>Start Time</th><th>End Time</th><th>Actions</th></tr>
            <tbody id="employeeTableBody"></tbody>
        </table>
    </div>
</body>
</html>