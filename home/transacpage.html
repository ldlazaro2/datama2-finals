<!DOCTYPE html>
<html>
<head>
    <title>Transaction Page - Shell Gas Station</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <style>
        body { background-color: white; display: flex; flex-direction: column; min-height: 100vh; }
        .w3-bar { background-color: #d50000 !important; color: white; }
        .w3-button { color: white !important; }
        .content { flex: 1; padding: 60px 20px 20px; }
        .card { background-color: #e0e0e0; padding: 20px; border-radius: 10px; margin-top: 20px; }
        .receipt-btn { background-color: #d50000; color: white; padding: 10px 20px; border-radius: 5px; cursor: pointer; display: block; text-align: center; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

<!-- Navbar -->
<div class="w3-top">
    <div class="w3-bar w3-card">
        <a href="#" class="w3-bar-item w3-button"><b>Shell</b> Gas Station</a>
        <a href="index.html" class="w3-bar-item w3-button w3-right">Home</a>
    </div>
</div>

<!-- Transaction Details -->
<div class="w3-content w3-padding content" style="max-width:600px">
    <h2 class="w3-margin-top">Transaction Summary</h2>
    <div class="card">
        <p><strong>Gas Type:</strong> <span id="gasTypeName">Loading...</span></p>
        <p><strong>Supplier:</strong> <span id="supplierName">Loading...</span></p>
        <p><strong>Total Cost:</strong> â‚±<span id="totalAmount">Loading...</span></p>
    </div>
    <a href="receipt.html" class="receipt-btn">Proceed to Receipt</a>
</div>

<script>
    // Initialize Supabase
    const supabase = supabase.createClient(
        "https://nyfcjxeebjzejsutbgub.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im55ZmNqeGVlYmp6ZWpzdXRiZ3ViIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA5MjI0MjUsImV4cCI6MjA1NjQ5ODQyNX0.OEkEIPw-AAtYwbp8BrZP-CfZNQ8WqZIwjVwunUwV1QE"
    );

    async function loadLatestOrder() {
        const { data, error } = await supabase
            .from("Orders")
            .select("productID, total_price, supplierID")
            .order("created_at", { ascending: false })
            .limit(1)
            .single();

        if (error) {
            console.error("Error loading order:", error.message);
            return;
        }

        // Fetch gas type name
        const { data: productData } = await supabase
            .from("Products")
            .select("product_name")
            .eq("productID", data.productID)
            .single();
        
        document.getElementById("gasTypeName").textContent = productData ? productData.product_name : "Unknown";
        document.getElementById("totalAmount").textContent = data.total_price;

        // Fetch supplier name
        const { data: supplierData } = await supabase
            .from("Supplier")
            .select("supplier_name")
            .eq("supplierID", data.supplierID)
            .single();
        
        document.getElementById("supplierName").textContent = supplierData ? supplierData.supplier_name : "Unknown";
    }

    document.addEventListener("DOMContentLoaded", loadLatestOrder);
</script>

</body>
</html>


